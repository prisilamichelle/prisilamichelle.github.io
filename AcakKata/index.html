<!DOCTYPE html>
<html>
    <head>
        <title>Game Acak Kata</title>
        <link rel="stylesheet" type="text/css" href="statics/css/home.css">
        <meta charset="utf-8"/>
    </head>
    <body>
        <div id="main">
            <div id="box-input" class="center small">
                <h1>Acak Kata</h1>

                <form id="input-form" autocomplete="off">
                    <table>
                        <tr>
                            <td><span>Tebak kata :</span></td>
                            <td><span id="shuffled-word"></span></td>
                        </tr>
                        <tr>
                            <td><span>Jawab :</span></td>
                            <td><input id="input-word" type="text" name="input-word" placeholder="Masukkan jawaban..."></td>
                        </tr>
                    </table>
                    <button id="btn-enter" class="btn-primary" type="button" onclick="checkInput()" >Enter</button>
                </form>

                <div id="failure-notif"></div>
                <div id="status"></div>
            </div>
        </div>
    </body>
    <script src="statics/js/ajax.js"></script>
    <script>
        let score, correctword, responsearray;
        window.onload = function() {
            score = 0;
            let url = "https://prisilamichelle.github.io/kata.txt";
            let ajax = requestGet(
                url,
                null,
                function(response) {
                    responsearray = response.split(",");
                    correctword = pickRandomWord(responsearray);
                    document.getElementById('shuffled-word').innerHTML = shuffleWord(correctword);
                }
            );
        };

        function pickRandomWord(array) {
            let index = Math.floor(Math.random() * array.length);
            return array[index];
        }
        
        /* Fisher-Yates shuffle */
        function shuffleWord(word) {
            let i = 0, j = 0, temp = null;
            let wordarray = word.split("");
            for(i = wordarray.length - 1; i > 0; i--) {
                j = Math.floor(Math.random() * (i + 1));
                temp = wordarray[i];
                wordarray[i] = wordarray[j];
                wordarray[j] = temp;
            }
            return wordarray.join("");
        }

        let hideFailureNotif = function() {
            document.getElementById('failure-notif').style.display = "none";
        };

        let failureNotifTimer = null;
        let showFailureNotif = function(message) {
            document.getElementById('failure-notif').innerHTML = message;
            document.getElementById('failure-notif').style.display = "block";
            clearTimeout(failureNotifTimer);
            failureNotifTimer = setTimeout(hideFailureNotif, 2000);
        };

        function showStatus(status,score){
            if (status === true) {
                document.getElementById('status').innerHTML = "<h2>BENAR! Poin Anda : " + score + "<h2>";
                document.getElementById('input-word').value = "";
            } else {
                document.getElementById('status').innerHTML = "<h2>SALAH! Silakan coba lagi.<h2>";
            }
        }

        function updateStatusScore() {
            score = score + 1;
            showStatus(true,score);
        }

        function updateWord() {
            correctword = pickRandomWord(responsearray);
            document.getElementById('shuffled-word').innerHTML = shuffleWord(correctword);
        }

        function checkInput() {
            let input = document.getElementById('input-word').value;
            if (input.trim() === "") {
                showFailureNotif("Harap masukkan kata sebelum menekan tombol enter.");
            } else {
                if (input === correctword) {
                    updateStatusScore();
                    updateWord();
                } else {
                    showStatus(false,score);
                }
            }   
        }

        document.getElementById("input-form").onkeypress = function(e) {
            let key = e.charCode || e.keyCode || 0;     
            if (key == 13) {
                e.preventDefault();
                checkInput();
            }
        }

    </script>
</html>